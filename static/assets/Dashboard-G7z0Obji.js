import{m as j,c as g,a as q,b as G}from"./api-CvrMnlWK.js";import{o as H,a as u,c as J,b as e,d as s,w as n,t as r,e as c,n as K,f as m,E as p,r as a,g as h}from"./index-gfZSHxez.js";const L={class:"dashboard"},O={class:"stats-grid"},Q={class:"stat-card"},U={class:"stat-icon primary"},X={class:"stat-info"},Y={class:"stat-card"},Z={class:"stat-icon success"},I={class:"stat-info"},tt={class:"stat-card"},et={class:"stat-icon info"},st={class:"stat-info"},nt={class:"stat-card"},ot={class:"stat-icon warning"},lt={class:"stat-info"},at={class:"card"},ct={class:"card-header"},it={class:"card"},dt={class:"card-header"},mt={__name:"Dashboard",setup(rt){const f=h({}),v=h([]),b=h([]),k=h([]),S=async()=>{try{const[o,t,_,i]=await Promise.all([j.getStats(),g.getAll(),q.getAll(),G.getAll()]);f.value=o,v.value=t,b.value=_,k.value=i}catch(o){p.error("加载数据失败"),console.error(o)}},x=o=>{if(!o)return"-";const t=k.value.find(_=>_.id===o);return t?t.display_name:o},B=o=>{if(!o)return"-";const t=v.value.find(_=>_.id===o);return t?t.name:o},w=async()=>{try{v.value=await g.getAll(),p.success("刷新成功")}catch{p.error("刷新失败")}},$=async o=>{try{await g.connect(o),p.success("连接成功"),await w()}catch{p.error("连接失败")}},E=async o=>{try{await g.disconnect(o),p.success("已断开连接"),await w()}catch{p.error("断开失败")}};return H(S),(o,t)=>{var R,D,N;const _=a("Connection"),i=a("el-icon"),V=a("ChatDotRound"),W=a("Collection"),F=a("Folder"),M=a("Refresh"),y=a("el-button"),d=a("el-table-column"),P=a("CircleCheck"),T=a("CircleClose"),A=a("el-table"),z=a("el-tag");return u(),J("div",L,[e("div",O,[e("div",Q,[e("div",U,[s(i,null,{default:n(()=>[s(_)]),_:1})]),e("div",X,[e("h3",null,r(((R=f.value.connections)==null?void 0:R.connected)||0)+" / "+r(((D=f.value.connections)==null?void 0:D.total)||0),1),t[1]||(t[1]=e("p",null,"WebSocket 连接",-1))])]),e("div",Y,[e("div",Z,[s(i,null,{default:n(()=>[s(V)]),_:1})]),e("div",I,[e("h3",null,r(((N=f.value.messages)==null?void 0:N.today)||0),1),t[2]||(t[2]=e("p",null,"今日消息",-1))])]),e("div",tt,[e("div",et,[s(i,null,{default:n(()=>[s(W)]),_:1})]),e("div",st,[e("h3",null,r(b.value.length),1),t[3]||(t[3]=e("p",null,"指令集",-1))])]),e("div",nt,[e("div",ot,[s(i,null,{default:n(()=>[s(F)]),_:1})]),e("div",lt,[e("h3",null,r(k.value.length),1),t[4]||(t[4]=e("p",null,"分类",-1))])])]),e("div",at,[e("div",ct,[t[6]||(t[6]=e("h2",null,"连接状态",-1)),s(y,{type:"primary",size:"small",onClick:w},{default:n(()=>[s(i,null,{default:n(()=>[s(M)]),_:1}),t[5]||(t[5]=c(" 刷新 ",-1))]),_:1})]),s(A,{data:v.value,stripe:""},{default:n(()=>[s(d,{prop:"name",label:"名称"}),s(d,{prop:"url",label:"地址"}),s(d,{label:"状态",width:"120"},{default:n(({row:l})=>[e("span",{class:K(["status-tag",l.connected?"connected":"disconnected"])},[l.connected?(u(),m(i,{key:0},{default:n(()=>[s(P)]),_:1})):(u(),m(i,{key:1},{default:n(()=>[s(T)]),_:1})),c(" "+r(l.connected?"已连接":"未连接"),1)],2)]),_:1}),s(d,{label:"操作",width:"150"},{default:n(({row:l})=>[l.connected?(u(),m(y,{key:1,type:"danger",size:"small",onClick:C=>E(l.id)},{default:n(()=>[...t[8]||(t[8]=[c(" 断开 ",-1)])]),_:1},8,["onClick"])):(u(),m(y,{key:0,type:"primary",size:"small",onClick:C=>$(l.id)},{default:n(()=>[...t[7]||(t[7]=[c(" 连接 ",-1)])]),_:1},8,["onClick"]))]),_:1})]),_:1},8,["data"])]),e("div",it,[e("div",dt,[t[10]||(t[10]=e("h2",null,"指令集概览",-1)),s(y,{type:"primary",size:"small",onClick:t[0]||(t[0]=l=>o.$router.push("/command-sets"))},{default:n(()=>[...t[9]||(t[9]=[c(" 管理指令集 ",-1)])]),_:1})]),s(A,{data:b.value,stripe:""},{default:n(()=>[s(d,{prop:"name",label:"名称"}),s(d,{label:"分类"},{default:n(({row:l})=>[c(r(x(l.category)),1)]),_:1}),s(d,{label:"类型",width:"120"},{default:n(({row:l})=>[l.is_public?(u(),m(z,{key:0,type:"success",size:"small"},{default:n(()=>[...t[11]||(t[11]=[c("公共",-1)])]),_:1})):l.mutual_exclusive_group?(u(),m(z,{key:1,type:"warning",size:"small"},{default:n(()=>[...t[12]||(t[12]=[c(" 互斥 ",-1)])]),_:1})):(u(),m(z,{key:2,type:"info",size:"small"},{default:n(()=>[...t[13]||(t[13]=[c("普通",-1)])]),_:1}))]),_:1}),s(d,{label:"目标连接"},{default:n(({row:l})=>[c(r(B(l.target_ws)),1)]),_:1}),s(d,{label:"指令数",width:"100"},{default:n(({row:l})=>{var C;return[c(r(((C=l.commands)==null?void 0:C.length)||0),1)]}),_:1})]),_:1},8,["data"])])])}}};export{mt as default};
