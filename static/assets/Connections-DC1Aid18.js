import{c as g}from"./api-CvrMnlWK.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{o as J,a as m,c as K,b as i,d as t,w as a,e as u,h as Q,f as b,t as C,n as R,i as X,E as r,r as s,l as Y,g as f,m as Z}from"./index-gfZSHxez.js";const h={class:"connections-page"},ee={class:"card"},le={class:"card-header"},te={__name:"Connections",setup(ae){const z=f([]),V=f(!1),p=f(!1),v=f(!1),x=f(!1),U=f(""),o=f({name:"",url:"",token:"",auto_reconnect:!0,reconnect_interval:5,allow_forward:!1}),S=n=>{const e=n?n.toLowerCase().replace(/[^a-z0-9\u4e00-\u9fa5]/g,"-").replace(/-+/g,"-").slice(0,20):"",d=Date.now().toString(36).slice(-4);return e?`${e}-${d}`:`conn-${d}`},k=async()=>{V.value=!0;try{z.value=await g.getAll()}catch{r.error("加载连接失败")}finally{V.value=!1}},N=()=>{v.value=!1,o.value={name:"",url:"",token:"",auto_reconnect:!0,reconnect_interval:5,allow_forward:!1},p.value=!0},T=n=>{v.value=!0,U.value=n.id,o.value={...n},p.value=!0},I=async()=>{if(!o.value.name.trim()){r.warning("请输入连接名称");return}if(!o.value.url.trim()){r.warning("请输入连接地址");return}x.value=!0;try{if(v.value)await g.update(U.value,o.value),r.success("更新成功");else{const n=S(o.value.name);await g.create({...o.value,id:n}),r.success("创建成功")}p.value=!1,await k()}catch(n){console.error("Submit error:",n),r.error(v.value?"更新失败":"创建失败")}finally{x.value=!1}},M=async n=>{try{await Z.confirm(`确定要删除连接「${n.name}」吗？`,"确认删除",{type:"warning"}),await g.delete(n.id),r.success("删除成功"),await k()}catch(e){e!=="cancel"&&r.error("删除失败")}},q=async n=>{var e,d;try{await g.connect(n.id),r.success("连接成功"),await k()}catch(_){console.error("Connect error:",_),r.error("连接失败："+(((d=(e=_.response)==null?void 0:e.data)==null?void 0:d.detail)||"未知错误"))}},A=async n=>{try{await g.disconnect(n.id),r.success("已断开"),await k()}catch{r.error("断开失败")}};return J(k),(n,e)=>{const d=s("Plus"),_=s("el-icon"),c=s("el-button"),w=s("el-table-column"),B=s("el-tag"),P=s("CircleCheck"),L=s("CircleClose"),O=s("el-table"),D=s("el-input"),y=s("el-form-item"),E=s("el-switch"),W=s("el-input-number"),j=s("el-form"),F=s("el-dialog"),G=Y("loading");return m(),K("div",h,[i("div",ee,[i("div",le,[e[9]||(e[9]=i("h2",null,"连接管理",-1)),t(c,{type:"primary",onClick:N},{default:a(()=>[t(_,null,{default:a(()=>[t(d)]),_:1}),e[8]||(e[8]=u(" 新建连接 ",-1))]),_:1})]),Q((m(),b(O,{data:z.value,stripe:""},{default:a(()=>[t(w,{prop:"name",label:"名称"}),t(w,{prop:"url",label:"地址","show-overflow-tooltip":""}),t(w,{label:"自动重连",width:"100"},{default:a(({row:l})=>[t(B,{type:l.auto_reconnect?"success":"info",size:"small"},{default:a(()=>[u(C(l.auto_reconnect?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),t(w,{label:"允许转发",width:"100"},{default:a(({row:l})=>[t(B,{type:l.allow_forward?"success":"info",size:"small"},{default:a(()=>[u(C(l.allow_forward?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),t(w,{label:"状态",width:"120"},{default:a(({row:l})=>[i("span",{class:R(["status-tag",l.connected?"connected":"disconnected"])},[l.connected?(m(),b(_,{key:0},{default:a(()=>[t(P)]),_:1})):(m(),b(_,{key:1},{default:a(()=>[t(L)]),_:1})),u(" "+C(l.connected?"已连接":"未连接"),1)],2)]),_:1}),t(w,{label:"操作",width:"250"},{default:a(({row:l})=>[l.connected?(m(),b(c,{key:1,type:"warning",size:"small",onClick:$=>A(l)},{default:a(()=>[...e[11]||(e[11]=[u(" 断开 ",-1)])]),_:1},8,["onClick"])):(m(),b(c,{key:0,type:"success",size:"small",onClick:$=>q(l)},{default:a(()=>[...e[10]||(e[10]=[u(" 连接 ",-1)])]),_:1},8,["onClick"])),t(c,{type:"primary",size:"small",onClick:$=>T(l)},{default:a(()=>[...e[12]||(e[12]=[u(" 编辑 ",-1)])]),_:1},8,["onClick"]),t(c,{type:"danger",size:"small",onClick:$=>M(l)},{default:a(()=>[...e[13]||(e[13]=[u(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[G,V.value]])]),t(F,{modelValue:p.value,"onUpdate:modelValue":e[7]||(e[7]=l=>p.value=l),title:v.value?"编辑连接":"新建连接",width:"500px"},{footer:a(()=>[t(c,{onClick:e[6]||(e[6]=l=>p.value=!1)},{default:a(()=>[...e[18]||(e[18]=[u("取消",-1)])]),_:1}),t(c,{type:"primary",onClick:I,loading:x.value},{default:a(()=>[u(C(v.value?"保存":"创建"),1)]),_:1},8,["loading"])]),default:a(()=>[t(j,{model:o.value,"label-width":"100px"},{default:a(()=>[t(y,{label:"名称",required:""},{default:a(()=>[t(D,{modelValue:o.value.name,"onUpdate:modelValue":e[0]||(e[0]=l=>o.value.name=l),placeholder:"连接名称（如：可爱机器人）"},null,8,["modelValue"])]),_:1}),t(y,{label:"地址",required:""},{default:a(()=>[t(D,{modelValue:o.value.url,"onUpdate:modelValue":e[1]||(e[1]=l=>o.value.url=l),placeholder:"ws://localhost:9001/onebot/v11/ws"},null,8,["modelValue"]),e[14]||(e[14]=i("div",{class:"form-tip"},"上游服务的 WebSocket 地址",-1))]),_:1}),t(y,{label:"Token"},{default:a(()=>[t(D,{modelValue:o.value.token,"onUpdate:modelValue":e[2]||(e[2]=l=>o.value.token=l),placeholder:"OneBot v11 认证 Token（可选）","show-password":""},null,8,["modelValue"]),e[15]||(e[15]=i("div",{class:"form-tip"},"如果服务需要认证，请填写 Token",-1))]),_:1}),t(y,{label:"自动重连"},{default:a(()=>[t(E,{modelValue:o.value.auto_reconnect,"onUpdate:modelValue":e[3]||(e[3]=l=>o.value.auto_reconnect=l)},null,8,["modelValue"])]),_:1}),o.value.auto_reconnect?(m(),b(y,{key:0,label:"重连间隔"},{default:a(()=>[t(W,{modelValue:o.value.reconnect_interval,"onUpdate:modelValue":e[4]||(e[4]=l=>o.value.reconnect_interval=l),min:1,max:60},null,8,["modelValue"]),e[16]||(e[16]=i("span",{style:{"margin-left":"10px"}},"秒",-1))]),_:1})):X("",!0),t(y,{label:"允许转发"},{default:a(()=>[t(E,{modelValue:o.value.allow_forward,"onUpdate:modelValue":e[5]||(e[5]=l=>o.value.allow_forward=l)},null,8,["modelValue"]),e[17]||(e[17]=i("div",{class:"form-tip"},"开启后，此连接可以主动发起消息并转发到其他连接",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},re=H(te,[["__scopeId","data-v-cf1a8552"]]);export{re as default};
