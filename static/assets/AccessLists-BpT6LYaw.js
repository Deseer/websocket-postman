import{d as x}from"./api-CvrMnlWK.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{o as K,a as L,c as O,b as f,d as l,w as t,e as i,h as Q,f as q,t as b,E as c,r as d,l as R,g as p,m as W,k as M}from"./index-gfZSHxez.js";const X={class:"access-lists-page"},Y={class:"action-bar"},Z={class:"card"},ee={class:"card"},le={__name:"AccessLists",setup(te){const $=p([]),w=p(!1),_=p(!1),g=p(!1),z=p(""),h=p(!1),y=p(""),o=p({id:"",name:"",type:"user",mode:"whitelist"}),P=M(()=>$.value.filter(s=>s.type==="user")),S=M(()=>$.value.filter(s=>s.type==="group")),j=s=>{const e=s?s.toLowerCase().replace(/[^a-z0-9\u4e00-\u9fa5]/g,"-").replace(/-+/g,"-").slice(0,20):"",n=Date.now().toString(36).slice(-4);return e?`${e}-${n}`:`list-${n}`},D=async()=>{w.value=!0;try{$.value=await x.getAll()}catch{c.error("加载数据失败")}finally{w.value=!1}},T=()=>{g.value=!1,z.value="",o.value={id:"",name:"",type:"user",mode:"whitelist"},y.value="",_.value=!0},E=s=>{g.value=!0,z.value=s.id,o.value={id:s.id,name:s.name,type:s.type,mode:s.mode},y.value=(s.items||[]).join(`
`),_.value=!0},F=async()=>{var s,e;if(!o.value.name){c.warning("请输入名称");return}h.value=!0;try{const n=y.value.split(`
`).map(u=>u.trim()).filter(u=>u&&/^\d+$/.test(u)).map(Number);if(g.value)await x.update(z.value,{name:o.value.name,type:o.value.type,mode:o.value.mode,items:n}),c.success("更新成功");else{const u=j(o.value.name);await x.create({id:u,name:o.value.name,type:o.value.type,mode:o.value.mode,items:n}),c.success("创建成功")}_.value=!1,await D()}catch(n){c.error(((e=(s=n.response)==null?void 0:s.data)==null?void 0:e.detail)||"操作失败")}finally{h.value=!1}},B=async s=>{var e,n;try{await W.confirm(`确定删除 "${s.name}" 吗？`,"确认删除",{type:"warning"}),await x.delete(s.id),c.success("删除成功"),await D()}catch(u){u!=="cancel"&&c.error(((n=(e=u.response)==null?void 0:e.data)==null?void 0:n.detail)||"删除失败")}};return K(D),(s,e)=>{const n=d("Plus"),u=d("el-icon"),v=d("el-button"),m=d("el-table-column"),V=d("el-tag"),I=d("el-table"),U=d("el-input"),k=d("el-form-item"),C=d("el-radio"),A=d("el-radio-group"),G=d("el-form"),H=d("el-dialog"),N=R("loading");return L(),O("div",X,[f("div",Y,[l(v,{type:"primary",onClick:T},{default:t(()=>[l(u,null,{default:t(()=>[l(n)]),_:1}),e[6]||(e[6]=i(" 新建黑白名单 ",-1))]),_:1})]),f("div",Z,[e[9]||(e[9]=f("div",{class:"card-header"},[f("h2",null,"用户黑白名单")],-1)),Q((L(),q(I,{data:P.value,stripe:""},{default:t(()=>[l(m,{prop:"name",label:"名称","min-width":"200"}),l(m,{label:"模式",width:"120"},{default:t(({row:a})=>[l(V,{type:a.mode==="whitelist"?"success":"danger",size:"small"},{default:t(()=>[i(b(a.mode==="whitelist"?"白名单":"黑名单"),1)]),_:2},1032,["type"])]),_:1}),l(m,{label:"成员数",width:"100"},{default:t(({row:a})=>[l(V,{size:"small"},{default:t(()=>{var r;return[i(b(((r=a.items)==null?void 0:r.length)||0)+" 人",1)]}),_:2},1024)]),_:1}),l(m,{label:"操作",width:"180",fixed:"right"},{default:t(({row:a})=>[l(v,{type:"primary",size:"small",onClick:r=>E(a)},{default:t(()=>[...e[7]||(e[7]=[i("编辑",-1)])]),_:1},8,["onClick"]),l(v,{type:"danger",size:"small",onClick:r=>B(a)},{default:t(()=>[...e[8]||(e[8]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[N,w.value]])]),f("div",ee,[e[12]||(e[12]=f("div",{class:"card-header"},[f("h2",null,"群聊黑白名单")],-1)),Q((L(),q(I,{data:S.value,stripe:""},{default:t(()=>[l(m,{prop:"name",label:"名称","min-width":"200"}),l(m,{label:"模式",width:"120"},{default:t(({row:a})=>[l(V,{type:a.mode==="whitelist"?"success":"danger",size:"small"},{default:t(()=>[i(b(a.mode==="whitelist"?"白名单":"黑名单"),1)]),_:2},1032,["type"])]),_:1}),l(m,{label:"成员数",width:"100"},{default:t(({row:a})=>[l(V,{size:"small"},{default:t(()=>{var r;return[i(b(((r=a.items)==null?void 0:r.length)||0)+" 个群",1)]}),_:2},1024)]),_:1}),l(m,{label:"操作",width:"180",fixed:"right"},{default:t(({row:a})=>[l(v,{type:"primary",size:"small",onClick:r=>E(a)},{default:t(()=>[...e[10]||(e[10]=[i("编辑",-1)])]),_:1},8,["onClick"]),l(v,{type:"danger",size:"small",onClick:r=>B(a)},{default:t(()=>[...e[11]||(e[11]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[N,w.value]])]),l(H,{modelValue:_.value,"onUpdate:modelValue":e[5]||(e[5]=a=>_.value=a),title:g.value?"编辑黑白名单":"新建黑白名单",width:"500px"},{footer:t(()=>[l(v,{onClick:e[4]||(e[4]=a=>_.value=!1)},{default:t(()=>[...e[17]||(e[17]=[i("取消",-1)])]),_:1}),l(v,{type:"primary",onClick:F,loading:h.value},{default:t(()=>[i(b(g.value?"保存":"创建"),1)]),_:1},8,["loading"])]),default:t(()=>[l(G,{model:o.value,"label-width":"100px"},{default:t(()=>[l(k,{label:"名称",required:""},{default:t(()=>[l(U,{modelValue:o.value.name,"onUpdate:modelValue":e[0]||(e[0]=a=>o.value.name=a),placeholder:"如 VIP 用户"},null,8,["modelValue"])]),_:1}),l(k,{label:"类型",required:""},{default:t(()=>[l(A,{modelValue:o.value.type,"onUpdate:modelValue":e[1]||(e[1]=a=>o.value.type=a)},{default:t(()=>[l(C,{value:"user"},{default:t(()=>[...e[13]||(e[13]=[i("用户",-1)])]),_:1}),l(C,{value:"group"},{default:t(()=>[...e[14]||(e[14]=[i("群聊",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(k,{label:"模式",required:""},{default:t(()=>[l(A,{modelValue:o.value.mode,"onUpdate:modelValue":e[2]||(e[2]=a=>o.value.mode=a)},{default:t(()=>[l(C,{value:"whitelist"},{default:t(()=>[...e[15]||(e[15]=[i("白名单",-1)])]),_:1}),l(C,{value:"blacklist"},{default:t(()=>[...e[16]||(e[16]=[i("黑名单",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(k,{label:o.value.type==="user"?"QQ 号列表":"群号列表"},{default:t(()=>[l(U,{modelValue:y.value,"onUpdate:modelValue":e[3]||(e[3]=a=>y.value=a),type:"textarea",rows:4,placeholder:o.value.type==="user"?"每行一个 QQ 号":"每行一个群号"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ie=J(le,[["__scopeId","data-v-46dd0e83"]]);export{ie as default};
