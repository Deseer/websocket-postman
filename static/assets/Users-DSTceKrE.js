import{o as W,a as u,c as U,b as V,d as a,w as n,p as X,h as Y,f as _,e as d,i as w,F as Z,j as I,E as q,r as s,g as o,l as ee,t as R}from"./index-gfZSHxez.js";import{u as A,a as le,b as te}from"./api-CvrMnlWK.js";const ae={class:"users-page"},ne={class:"card"},se={class:"card-header"},oe={key:0,style:{color:"#999"}},ie={style:{"margin-top":"20px","text-align":"right"}},me={__name:"Users",setup(ue){const v=o([]),N=o([]),Q=o([]),m=o(!1),p=o(!1),h=o(!1),g=o(""),f=o(1),C=o(20),D=o(0),i=o({qq_id:0,nickname:"",is_privileged:!1}),y=async()=>{m.value=!0;try{const l=(f.value-1)*C.value,[e,r,x]=await Promise.all([A.getAll(l,C.value),le.getAll(),te.getAll()]);v.value=e,N.value=r,Q.value=x,D.value=e.length}catch{q.error("加载数据失败")}finally{m.value=!1}},j=l=>{if(!l)return l;const e=Q.value.find(r=>r.id===l);return e?e.display_name:l},F=l=>{if(!l)return l;const e=N.value.find(r=>r.id===l);return e?e.name:l},B=async()=>{if(!g.value){await y();return}m.value=!0;try{const l=await A.get(parseInt(g.value));v.value=[l]}catch{q.warning("未找到该用户"),v.value=[]}finally{m.value=!1}},K=l=>{i.value={qq_id:l.qq_id,nickname:l.nickname||"",is_privileged:l.is_privileged||!1},p.value=!0},M=async()=>{h.value=!0;try{await A.update(i.value.qq_id,i.value),q.success("更新成功"),p.value=!1,await y()}catch{q.error("更新失败")}finally{h.value=!1}},$=l=>{f.value=l,y()};return W(y),(l,e)=>{const r=s("Search"),x=s("el-icon"),b=s("el-button"),z=s("el-input"),c=s("el-table-column"),k=s("el-tag"),L=s("el-table"),O=s("el-pagination"),S=s("el-form-item"),T=s("el-switch"),G=s("el-form"),H=s("el-dialog"),J=ee("loading");return u(),U("div",ae,[V("div",ne,[V("div",se,[e[7]||(e[7]=V("h2",null,"用户管理",-1)),a(z,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=t=>g.value=t),placeholder:"输入 QQ 号搜索",style:{width:"200px"},onKeyup:X(B,["enter"])},{append:n(()=>[a(b,{onClick:B},{default:n(()=>[a(x,null,{default:n(()=>[a(r)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),Y((u(),_(L,{data:v.value,stripe:""},{default:n(()=>[a(c,{prop:"qq_id",label:"QQ 号",width:"150"}),a(c,{prop:"nickname",label:"昵称",width:"150"}),a(c,{label:"权限",width:"150"},{default:n(({row:t})=>[t.is_admin?(u(),_(k,{key:0,type:"danger",size:"small"},{default:n(()=>[...e[8]||(e[8]=[d("管理员",-1)])]),_:1})):w("",!0),t.is_privileged?(u(),_(k,{key:1,type:"warning",size:"small"},{default:n(()=>[...e[9]||(e[9]=[d("特权",-1)])]),_:1})):w("",!0),!t.is_admin&&!t.is_privileged?(u(),_(k,{key:2,type:"info",size:"small"},{default:n(()=>[...e[10]||(e[10]=[d(" 普通 ",-1)])]),_:1})):w("",!0)]),_:1}),a(c,{label:"已选风格","min-width":"200"},{default:n(({row:t})=>[(u(!0),U(Z,null,I(t.selected_styles||{},(E,P)=>(u(),_(k,{key:P,size:"small",type:"success",style:{"margin-right":"5px"}},{default:n(()=>[d(R(j(P))+": "+R(F(E)),1)]),_:2},1024))),128)),Object.keys(t.selected_styles||{}).length?w("",!0):(u(),U("span",oe," 未选择 "))]),_:1}),a(c,{label:"操作",width:"150"},{default:n(({row:t})=>[a(b,{type:"primary",size:"small",onClick:E=>K(t)},{default:n(()=>[...e[11]||(e[11]=[d(" 编辑 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[J,m.value]]),V("div",ie,[a(O,{"current-page":f.value,"onUpdate:currentPage":e[1]||(e[1]=t=>f.value=t),"page-size":C.value,total:D.value,layout:"total, prev, pager, next",onCurrentChange:$},null,8,["current-page","page-size","total"])])]),a(H,{modelValue:p.value,"onUpdate:modelValue":e[6]||(e[6]=t=>p.value=t),title:"编辑用户",width:"600px"},{footer:n(()=>[a(b,{onClick:e[5]||(e[5]=t=>p.value=!1)},{default:n(()=>[...e[12]||(e[12]=[d("取消",-1)])]),_:1}),a(b,{type:"primary",onClick:M,loading:h.value},{default:n(()=>[...e[13]||(e[13]=[d(" 保存 ",-1)])]),_:1},8,["loading"])]),default:n(()=>[a(G,{model:i.value,"label-width":"120px"},{default:n(()=>[a(S,{label:"QQ 号"},{default:n(()=>[a(z,{modelValue:i.value.qq_id,"onUpdate:modelValue":e[2]||(e[2]=t=>i.value.qq_id=t),disabled:""},null,8,["modelValue"])]),_:1}),a(S,{label:"昵称"},{default:n(()=>[a(z,{modelValue:i.value.nickname,"onUpdate:modelValue":e[3]||(e[3]=t=>i.value.nickname=t)},null,8,["modelValue"])]),_:1}),a(S,{label:"特权用户"},{default:n(()=>[a(T,{modelValue:i.value.is_privileged,"onUpdate:modelValue":e[4]||(e[4]=t=>i.value.is_privileged=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}};export{me as default};
